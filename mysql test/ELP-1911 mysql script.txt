CREATE SCHEMA `donalschema` ;

CREATE TABLE `donalschema`.`customers` (
  `cust_id` VARCHAR(255) NOT NULL COMMENT 'Unique Id to identify the customer team. A customer team may have multiple bots but should have a unique customer Id.',
  `team_description` TEXT NULL,
  PRIMARY KEY (`cust_id`))
COMMENT = 'These are customer teams that have chatbots integrated with the virtual assistant framework.';

CREATE TABLE `donalschema`.`bots` (
  `bot_id` INT NOT NULL AUTO_INCREMENT,
  `cust_id` VARCHAR(255) NULL,
  `bot_code` VARCHAR(255) NULL,
  `description` TEXT NULL,
  `customisations` TEXT NULL,
  `uses_liveengage` BIT NULL,
  `life_stage` INT NULL,
  `enabled` BIT NULL,
  `status` VARCHAR(255) NULL,
  PRIMARY KEY (`bot_id`))
COMMENT = 'Integrated customer bots.';

CREATE TABLE `donalschema`.`status_logs` (
  `bot_id` INT NOT NULL,
  `change_time` DATETIME NULL,
  `new_status` VARCHAR(255) NULL,
  `notes` TEXT NULL)
COMMENT = 'A log (history) of status changes, whether changed manually or caused by the system.';

CREATE TABLE `donalschema`.`health_check` (
  `bot_id` INT NULL,
  `endpoint` TEXT NULL COMMENT 'A full URL that can be GETed. Can be http or https.',
  `response_type` VARCHAR(255) NULL COMMENT 'Values should be something like JSON, HTTP_STATUS, etc.',
  `expected_response` VARCHAR(255) NULL COMMENT 'Depends on response_type. If response_type=JSON then this would usually be a key-value-pair, e.g. STATUS:OK. If response_type=HTTP_STATUS this might be 200 or 201 etc.Otherwise it might be a human readable description of what the response should look like.',
  `auto_check` BIT NULL COMMENT 'If 1 then the system expects to be able to automatically GET the endpoint and check the response against the expected_response to determine if it is healthy. If 0, then it is expected that the response needs to be checked by a human to determine if it looks as expected.')
COMMENT = 'Each bot may have multiple health checks.';

CREATE TABLE `donalschema`.`conversations` (
  `conv_id` INT NOT NULL AUTO_INCREMENT,
  `start_time` DATETIME NULL COMMENT 'The time at which the VA framework first knows aout the conversation.',
  `bot_id` INT NULL,
  `is_test` BIT NULL COMMENT 'Whether or not this conversation is a test, initiated by VA Support or someone on the Customer Team. This allows us to aggregate stats ignoring test conversations.',
  PRIMARY KEY (`conv_id`))
COMMENT = 'Each conversation/dialog with a user. This is a single conversation session as identified by the Connector/Architect. If there is a mechanism for a user to return to, or re-open, an issue that would result in a new conversation in this table.';

CREATE TABLE `donalschema`.`conv_events` (
  `ev_id` INT NOT NULL AUTO_INCREMENT,
  `conv_id` INT NULL,
  `evtype` VARCHAR(255) NULL COMMENT 'Event type - should be one of INTENT_IDENTIFIED, INTENT_WRONG, ESCALATE, ABANDON, SUCCESS, etc.',
  `evtime` DATETIME NULL,
  PRIMARY KEY (`ev_id`))
COMMENT = 'Conversation events that we want to track.';

CREATE TABLE `donalschema`.`conv_timings` (
  `timing_id` INT NOT NULL AUTO_INCREMENT,
  `conv_id` INT NULL,
  `component` VARCHAR(255) NULL COMMENT 'This may be a VA Framework component, e.g. TRANSLATION, DBACCESS. It can also be an external component, e,g, the bot (Lex, Amelia, etc.). It can also possibly be some other action which might possibly be a custom action of a particular bot.',
  `start_time` DATETIME NULL,
  `duration_msecs` BIGINT NULL,
  PRIMARY KEY (`timing_id`))
COMMENT = 'Tracking timings of things like time for the external bot to respond, time to query database, etc.';

CREATE TABLE `donalschema`.`conv_text` (
  `text_id` INT NOT NULL AUTO_INCREMENT,
  `conv_id` INT NULL,
  `text_time` DATETIME NULL,
  `text_src` VARCHAR(255) NULL COMMENT 'This should (usually) be either BOT or USER. Using a string column allows for the possibility later that there could be other sources, e.g. distinguishing between LiveEngage-initiated message and bot-initiated message.',
  `text_content` TEXT NULL,
  PRIMARY KEY (`text_id`))
COMMENT = 'Records of the plain text of user messages and bot responses. As far as possible, this should NOT contain full response JSON bodies eetc. It should be only the text that the user would see. Some very simple representation of links and buttons may have to be allowed for.';





